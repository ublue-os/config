#!/usr/bin/env bash
##################################################################
# This is a helper script to provide a basic fallback replacement 
# for just commands and bash scripts that want to use gum in uBlue
##################################################################

# Check if gum is present
GUM=$(which gum 2>/dev/null)

function nogum () {
    if [[ -z "$1" ]]; then
        # If no arguments are provided then error with 
        echo "ugum supports only choose or confirm as the first argument!"
        exit 5
    elif [[ "$1" == "choose" ]]; then
        # If choose is the verb then run the choose function and pass all remaining args to it
        choose "${@:2}"
    fi
}

function choose () {
    # Change PS3 to our select prompt
    PS3='Please enter your choice: '
    options=("$@")

    # Make a select prompt in bash
    select opt in "${options[@]}"
    do
        case $opt in
            "")
                # Invalid options print to STDERR and then loops back for the user to select again
                echo "Invalid option $REPLY" >&2
                ;;
            "$opt")
                echo "$opt"
                break
                ;;
        esac
    done 
}

# If gum is not present
if [[ -z "$GUM" ]]; then
    nogum "$@"
else
    # If gum is present just pass args to gum
    $GUM "$@"
fi

# Exit normally to just mimic gum
exit 0
